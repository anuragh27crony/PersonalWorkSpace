import time
from random import randint

from Ceco.FpsUtil import FpsUtil
import os
import json

fputil = FpsUtil()
fputil.clean_existing_feeds()


# # base64_ceco_str = fputil.ceco_utils.create_ceco_base64_str(
# #     ceco_file_path="D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\14\\ceco\\WcV0130180212142500_03.ce")
#
# ceco_dir = 'D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\remux'
# fputil.ingest_ref_ceco(ref_ceco_dir=ceco_dir,
#                        ref_ceco_file_name='remux_5_min.mp4.ce', feed_id='29356751')
#
# fputil.ingest_ref_ceco(ref_ceco_dir=ceco_dir,
#                        ref_ceco_file_name='5_min.mp4.ce', feed_id='29356752')
#
# # fputil.analyze_candidate_ceco()
#
# detec_cecodir = 'D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\ceco\\bc'
# print(fputil.analyze_ceco(ceco_file_path=os.path.join(detec_cecodir, 'WcD01301802120415_03.ce')))
#
# # print(base64_ceco_str)

def generate_fps_results():
    feed_id = 0

    # mux_cecodir='D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\remux'
    mux_cecodir='D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\5remux\\'
    # trans_cecodir='D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\trans'
    trans_cecodir='D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\5trans\\'
    detec_cecodir = 'D:\\Dump\\CecoComparision\\4.5-4.4.17\\no_ts\\ceco\\bc'

    trans_files=['0_TcV0130_1802120010_1802120016.mp4.ce', '1_TcV0130_1802121718_1802121724.mp4.ce', '2_TcV0130_1802120957_1802121002.mp4.ce', '3_TcV0130_1802121046_1802121052.mp4.ce', '4_TcV0130_1802120401_1802120406.mp4.ce', '5_TcV0130_1802121329_1802121335.mp4.ce', '6_TcV0130_1802120616_1802120622.mp4.ce', '7_TcV0130_1802120611_1802120616.mp4.ce', '8_TcV0130_1802120548_1802120554.mp4.ce', '9_TcV0130_1802121613_1802121619.mp4.ce', '10_TcV0130_1802122340_1802122347.mp4.ce', '11_TcV0130_1802121536_1802121541.mp4.ce', '12_TcV0130_1802120904_1802120909.mp4.ce', '13_TcV0130_1802121206_1802121212.mp4.ce', '14_TcV0130_1802122058_1802122103.mp4.ce', '15_TcV0130_1802120952_1802120959.mp4.ce', '16_TcV0130_1802122123_1802122129.mp4.ce', '17_TcV0130_1802120242_1802120247.mp4.ce', '18_TcV0130_1802121120_1802121125.mp4.ce', '19_TcV0130_1802120100_1802120106.mp4.ce', '20_TcV0130_1802120806_1802120811.mp4.ce', '21_TcV0130_1802121609_1802121614.mp4.ce', '22_TcV0130_1802121507_1802121512.mp4.ce', '23_TcV0130_1802121243_1802121249.mp4.ce', '24_TcV0130_1802120512_1802120518.mp4.ce', '25_TcV0130_1802121402_1802121409.mp4.ce', '26_TcV0130_1802120129_1802120135.mp4.ce', '27_TcV0130_1802122005_1802122011.mp4.ce', '28_TcV0130_1802120352_1802120358.mp4.ce', '29_TcV0130_1802121053_1802121059.mp4.ce', '30_TcV0130_1802122011_1802122016.mp4.ce', '31_TcV0130_1802121647_1802121653.mp4.ce', '32_TcV0130_1802120919_1802120925.mp4.ce', '33_TcV0130_1802120743_1802120749.mp4.ce', '34_TcV0130_1802120852_1802120858.mp4.ce', '35_TcV0130_1802120112_1802120118.mp4.ce', '36_TcV0130_1802120353_1802120358.mp4.ce', '37_TcV0130_1802121523_1802121530.mp4.ce', '38_TcV0130_1802122048_1802122054.mp4.ce', '39_TcV0130_1802120504_1802120509.mp4.ce', '40_TcV0130_1802120059_1802120105.mp4.ce', '41_TcV0130_1802120106_1802120112.mp4.ce', '42_TcV0130_1802122240_1802122246.mp4.ce', '43_TcV0130_1802121037_1802121042.mp4.ce', '44_TcV0130_1802120706_1802120712.mp4.ce', '45_TcV0130_1802121220_1802121226.mp4.ce', '46_TcV0130_1802122211_1802122216.mp4.ce', '47_TcV0130_1802122019_1802122024.mp4.ce', '48_TcV0130_1802121222_1802121228.mp4.ce', '49_TcV0130_1802120004_1802120010.mp4.ce', '50_TcV0130_1802121607_1802121613.mp4.ce', '51_TcV0130_1802121913_1802121919.mp4.ce', '52_TcV0130_1802122101_1802122106.mp4.ce', '53_TcV0130_1802120532_1802120539.mp4.ce', '54_TcV0130_1802120435_1802120440.mp4.ce', '55_TcV0130_1802121756_1802121802.mp4.ce', '56_TcV0130_1802122330_1802122335.mp4.ce', '57_TcV0130_1802121915_1802121920.mp4.ce', '58_TcV0130_1802121850_1802121857.mp4.ce', '59_TcV0130_1802121732_1802121738.mp4.ce', '60_TcV0130_1802122227_1802122232.mp4.ce', '61_TcV0130_1802121723_1802121728.mp4.ce', '62_TcV0130_1802120018_1802120024.mp4.ce', '63_TcV0130_1802122206_1802122212.mp4.ce', '64_TcV0130_1802121703_1802121710.mp4.ce', '65_TcV0130_1802121530_1802121536.mp4.ce', '66_TcV0130_1802121957_1802122002.mp4.ce', '67_TcV0130_1802121816_1802121821.mp4.ce', '68_TcV0130_1802120946_1802120952.mp4.ce', '69_TcV0130_1802121951_1802121956.mp4.ce', '70_TcV0130_1802120528_1802120533.mp4.ce', '71_TcV0130_1802122333_1802122339.mp4.ce', '72_TcV0130_1802121053_1802121059.mp4.ce', '73_TcV0130_1802122056_1802122103.mp4.ce', '74_TcV0130_1802122145_1802122151.mp4.ce', '75_TcV0130_1802121717_1802121724.mp4.ce', '76_TcV0130_1802122002_1802122008.mp4.ce', '77_TcV0130_1802120225_1802120231.mp4.ce', '78_TcV0130_1802120717_1802120723.mp4.ce', '79_TcV0130_1802122318_1802122324.mp4.ce', '80_TcV0130_1802122019_1802122026.mp4.ce', '81_TcV0130_1802120902_1802120908.mp4.ce', '82_TcV0130_1802120422_1802120428.mp4.ce', '83_TcV0130_1802121252_1802121258.mp4.ce', '84_TcV0130_1802120028_1802120033.mp4.ce', '85_TcV0130_1802121031_1802121038.mp4.ce', '86_TcV0130_1802120520_1802120526.mp4.ce', '87_TcV0130_1802122025_1802122032.mp4.ce', '88_TcV0130_1802122150_1802122156.mp4.ce', '89_TcV0130_1802121328_1802121333.mp4.ce', '90_TcV0130_1802120214_1802120220.mp4.ce', '91_TcV0130_1802121356_1802121401.mp4.ce', '92_TcV0130_1802120213_1802120219.mp4.ce', '93_TcV0130_1802121806_1802121812.mp4.ce', '94_TcV0130_1802120537_1802120542.mp4.ce', '95_TcV0130_1802120153_1802120158.mp4.ce', '96_TcV0130_1802122304_1802122309.mp4.ce', '97_TcV0130_1802121122_1802121129.mp4.ce', '98_TcV0130_1802120746_1802120753.mp4.ce', '99_TcV0130_1802120247_1802120253.mp4.ce']
    detec_ceco_files=['WcD01301802120000_03.ce','WcD01301802121715_03.ce','WcD01301802120945_03.ce','WcD01301802121045_03.ce','WcD01301802120400_03.ce','WcD01301802121315_03.ce','WcD01301802120615_03.ce','WcD01301802120600_03.ce','WcD01301802120545_03.ce','WcD01301802121600_03.ce','WcD01301802122330_03.ce','WcD01301802121530_03.ce','WcD01301802120900_03.ce','WcD01301802121200_03.ce','WcD01301802122045_03.ce','WcD01301802120945_03.ce','WcD01301802122115_03.ce','WcD01301802120230_03.ce','WcD01301802121115_03.ce','WcD01301802120100_03.ce','WcD01301802120800_03.ce','WcD01301802121600_03.ce','WcD01301802121500_03.ce','WcD01301802121230_03.ce','WcD01301802120500_03.ce','WcD01301802121400_03.ce','WcD01301802120115_03.ce','WcD01301802122000_03.ce','WcD01301802120345_03.ce','WcD01301802121045_03.ce','WcD01301802122000_03.ce','WcD01301802121645_03.ce','WcD01301802120915_03.ce','WcD01301802120730_03.ce','WcD01301802120845_03.ce','WcD01301802120100_03.ce','WcD01301802120345_03.ce','WcD01301802121515_03.ce','WcD01301802122045_03.ce','WcD01301802120500_03.ce','WcD01301802120045_03.ce','WcD01301802120100_03.ce','WcD01301802122230_03.ce','WcD01301802121030_03.ce','WcD01301802120700_03.ce','WcD01301802121215_03.ce','WcD01301802122200_03.ce','WcD01301802122015_03.ce','WcD01301802121215_03.ce','WcD01301802120000_03.ce','WcD01301802121600_03.ce','WcD01301802121900_03.ce','WcD01301802122100_03.ce','WcD01301802120530_03.ce','WcD01301802120430_03.ce','WcD01301802121745_03.ce','WcD01301802122330_03.ce','WcD01301802121915_03.ce','WcD01301802121845_03.ce','WcD01301802121730_03.ce','WcD01301802122215_03.ce','WcD01301802121715_03.ce','WcD01301802120015_03.ce','WcD01301802122200_03.ce','WcD01301802121700_03.ce','WcD01301802121530_03.ce','WcD01301802121945_03.ce','WcD01301802121815_03.ce','WcD01301802120945_03.ce','WcD01301802121945_03.ce','WcD01301802120515_03.ce','WcD01301802122330_03.ce','WcD01301802121045_03.ce','WcD01301802122045_03.ce','WcD01301802122145_03.ce','WcD01301802121715_03.ce','WcD01301802122000_03.ce','WcD01301802120215_03.ce','WcD01301802120715_03.ce','WcD01301802122315_03.ce','WcD01301802122015_03.ce','WcD01301802120900_03.ce','WcD01301802120415_03.ce','WcD01301802121245_03.ce','WcD01301802120015_03.ce','WcD01301802121030_03.ce','WcD01301802120515_03.ce','WcD01301802122015_03.ce','WcD01301802122145_03.ce','WcD01301802121315_03.ce','WcD01301802120200_03.ce','WcD01301802121345_03.ce','WcD01301802120200_03.ce','WcD01301802121800_03.ce','WcD01301802120530_03.ce','WcD01301802120145_03.ce','WcD01301802122300_03.ce','WcD01301802121115_03.ce','WcD01301802120745_03.ce']

    mux_files= ['0_McV0130_1802120010_1802120016.mp4.ce', '1_McV0130_1802121718_1802121724.mp4.ce', '2_McV0130_1802120957_1802121002.mp4.ce', '3_McV0130_1802121046_1802121052.mp4.ce', '4_McV0130_1802120401_1802120406.mp4.ce', '5_McV0130_1802121329_1802121335.mp4.ce', '6_McV0130_1802120616_1802120622.mp4.ce', '7_McV0130_1802120611_1802120616.mp4.ce', '8_McV0130_1802120548_1802120554.mp4.ce', '9_McV0130_1802121613_1802121619.mp4.ce', '10_McV0130_1802122340_1802122347.mp4.ce', '11_McV0130_1802121536_1802121541.mp4.ce', '12_McV0130_1802120904_1802120909.mp4.ce', '13_McV0130_1802121206_1802121212.mp4.ce', '14_McV0130_1802122058_1802122103.mp4.ce', '15_McV0130_1802120952_1802120959.mp4.ce', '16_McV0130_1802122123_1802122129.mp4.ce', '17_McV0130_1802120242_1802120247.mp4.ce', '18_McV0130_1802121120_1802121125.mp4.ce', '19_McV0130_1802120100_1802120106.mp4.ce', '20_McV0130_1802120806_1802120811.mp4.ce', '21_McV0130_1802121609_1802121614.mp4.ce', '22_McV0130_1802121507_1802121512.mp4.ce', '23_McV0130_1802121243_1802121249.mp4.ce', '24_McV0130_1802120512_1802120518.mp4.ce', '25_McV0130_1802121402_1802121409.mp4.ce', '26_McV0130_1802120129_1802120135.mp4.ce', '27_McV0130_1802122005_1802122011.mp4.ce', '28_McV0130_1802120352_1802120358.mp4.ce', '29_McV0130_1802121053_1802121059.mp4.ce', '30_McV0130_1802122011_1802122016.mp4.ce', '31_McV0130_1802121647_1802121653.mp4.ce', '32_McV0130_1802120919_1802120925.mp4.ce', '33_McV0130_1802120743_1802120749.mp4.ce', '34_McV0130_1802120852_1802120858.mp4.ce', '35_McV0130_1802120112_1802120118.mp4.ce', '36_McV0130_1802120353_1802120358.mp4.ce', '37_McV0130_1802121523_1802121530.mp4.ce', '38_McV0130_1802122048_1802122054.mp4.ce', '39_McV0130_1802120504_1802120509.mp4.ce', '40_McV0130_1802120059_1802120105.mp4.ce', '41_McV0130_1802120106_1802120112.mp4.ce', '42_McV0130_1802122240_1802122246.mp4.ce', '43_McV0130_1802121037_1802121042.mp4.ce', '44_McV0130_1802120706_1802120712.mp4.ce', '45_McV0130_1802121220_1802121226.mp4.ce', '46_McV0130_1802122211_1802122216.mp4.ce', '47_McV0130_1802122019_1802122024.mp4.ce', '48_McV0130_1802121222_1802121228.mp4.ce', '49_McV0130_1802120004_1802120010.mp4.ce', '50_McV0130_1802121607_1802121613.mp4.ce', '51_McV0130_1802121913_1802121919.mp4.ce', '52_McV0130_1802122101_1802122106.mp4.ce', '53_McV0130_1802120532_1802120539.mp4.ce', '54_McV0130_1802120435_1802120440.mp4.ce', '55_McV0130_1802121756_1802121802.mp4.ce', '56_McV0130_1802122330_1802122335.mp4.ce', '57_McV0130_1802121915_1802121920.mp4.ce', '58_McV0130_1802121850_1802121857.mp4.ce', '59_McV0130_1802121732_1802121738.mp4.ce', '60_McV0130_1802122227_1802122232.mp4.ce', '61_McV0130_1802121723_1802121728.mp4.ce', '62_McV0130_1802120018_1802120024.mp4.ce', '63_McV0130_1802122206_1802122212.mp4.ce', '64_McV0130_1802121703_1802121710.mp4.ce', '65_McV0130_1802121530_1802121536.mp4.ce', '66_McV0130_1802121957_1802122002.mp4.ce', '67_McV0130_1802121816_1802121821.mp4.ce', '68_McV0130_1802120946_1802120952.mp4.ce', '69_McV0130_1802121951_1802121956.mp4.ce', '70_McV0130_1802120528_1802120533.mp4.ce', '71_McV0130_1802122333_1802122339.mp4.ce', '72_McV0130_1802121053_1802121059.mp4.ce', '73_McV0130_1802122056_1802122103.mp4.ce', '74_McV0130_1802122145_1802122151.mp4.ce', '75_McV0130_1802121717_1802121724.mp4.ce', '76_McV0130_1802122002_1802122008.mp4.ce', '77_McV0130_1802120225_1802120231.mp4.ce', '78_McV0130_1802120717_1802120723.mp4.ce', '79_McV0130_1802122318_1802122324.mp4.ce', '80_McV0130_1802122019_1802122026.mp4.ce', '81_McV0130_1802120902_1802120908.mp4.ce', '82_McV0130_1802120422_1802120428.mp4.ce', '83_McV0130_1802121252_1802121258.mp4.ce', '84_McV0130_1802120028_1802120033.mp4.ce', '85_McV0130_1802121031_1802121038.mp4.ce', '86_McV0130_1802120520_1802120526.mp4.ce', '87_McV0130_1802122025_1802122032.mp4.ce', '88_McV0130_1802122150_1802122156.mp4.ce', '89_McV0130_1802121328_1802121333.mp4.ce', '90_McV0130_1802120214_1802120220.mp4.ce', '91_McV0130_1802121356_1802121401.mp4.ce', '92_McV0130_1802120213_1802120219.mp4.ce', '93_McV0130_1802121806_1802121812.mp4.ce', '94_McV0130_1802120537_1802120542.mp4.ce', '95_McV0130_1802120153_1802120158.mp4.ce', '96_McV0130_1802122304_1802122309.mp4.ce', '97_McV0130_1802121122_1802121129.mp4.ce', '98_McV0130_1802120746_1802120753.mp4.ce', '99_McV0130_1802120247_1802120253.mp4.ce']


    result = dict()
    fputil.clean_existing_feeds()
    for i in range(0, 100):
        try:
            feed_id += 1
            fputil.ingest_ref_ceco(ref_ceco_dir=mux_cecodir, ref_ceco_file_name=mux_files[i], feed_id=str(feed_id))
            feed_id += 1
            fputil.ingest_ref_ceco(ref_ceco_dir=trans_cecodir, ref_ceco_file_name=trans_files[i], feed_id=str(feed_id))

            result.update({i: json.loads(fputil.analyze_ceco(ceco_file_path=os.path.join(detec_cecodir, detec_ceco_files[i])))})

            fputil.clean_existing_feeds()
            time.sleep(randint(5,10))
        except Exception as e:
            print(e)
    fputil.clean_existing_feeds()
    with open(os.path.join(os.getcwd(), "long_assets_results_1.json"), "a+") as file:
        file.writelines(json.dumps(result))


def read_json_results(filename,output_file):
    with open(os.path.join(os.getcwd(), filename), "r") as file:
        input_data = json.loads(file.read())

    with open(os.path.join(os.getcwd(), output_file), "a+") as file:
        file.writelines("id,ref_type,start_offset,end_offset,duration\n")

    for iter in range(0, 500):
        try:
            search_results = input_data.get(str(iter)).get("data").get("results")
            for result_item in search_results:
                # print(result_item)
                ref_type = "mux" if int(result_item.get("id")) % 2 != 0 else "trans"
                ref_start_offset = result_item.get("referenceStartOffset")
                ref_end_offset = result_item.get("referenceEndOffset")
                avg_ber=result_item.get("berAverage")
                duration = int(ref_end_offset) - int(ref_start_offset)

                with open(os.path.join(os.getcwd(), output_file), "a+") as file:
                    file.writelines("{0},{1},{2},{3},{4},{5}\n".format(iter, ref_type, ref_start_offset, ref_end_offset,avg_ber, duration))
        except Exception as e:
            print("Exception Occured at {0}".format(iter))


read_json_results("short_assets_results.json", output_file="short_assets_compile_ber.csv")